#pragma once
#include "crc_table.h"
#include <string>
#include <vector>

// https://stackoverflow.com/questions/2111667/compile-time-string-hashing
// https://gcc.godbolt.org/#%7B%22version%22%3A3%2C%22filterAsm%22%3A%7B%22labels%22%3Atrue%2C%22directives%22%3Atrue%2C%22commentOnly%22%3Atrue%2C%22colouriseAsm%22%3Atrue%7D%2C%22compilers%22%3A%5B%7B%22sourcez%22%3A%22MQSwdgxgNgrgJgUwAQB4QHsDOAXATggQwFsA%2BAKFElkVR13AHNzLp5kUA3BCbdXcsjgLYQEJBHRgcCAB4AHXEhjhsAZgBMAfWzjcEbQQBGUBAG11AVgBsAXSQBeJAG8ySN0gAMMjz98%2BANJ4yAOzBHsGqHgCcVoFeCAgeCFYAjOoQcTJRUdEWKYYEmeFWcBAALClRmWFWBABmZQAcdf5kAJDxMaoEFqoWmVHJZVEWBKr%2BHd4IcIaNjRrVUaWzBGWZiXAWCFEpCAPBcOpwUXOtk9GGVmUQ6obVCIYpwRCGcOvBs0fhAx6GdSnHFKZAGGYIpDxXTK1QwedQeOrqM5eOqqQxRMFNTKNMqGBAVRATLwpAhwEllA5QuBUvEPTINOA4ix5LGqOCqRoWCDBJEyFKqKwQE7WKFlKwFRoQDx0uBWdR1dGFIKNAhWTmDDKTFJlDwpTllFpBKyRKwC448uoEeGso1YuAeRoeOB1fqTVFWBBwiCNTLXKw7DxbTKbKweCp4zIEdRWUJPRHtLyqSWqPFwIFBHGhhnkoNwuAcupvII9DxGax3V0WQyjZqKrxlW7qE4CnkzQyGQUyiMvCDy7WEmQaPMChDjdMWJ2c4L9IKlGWOnsR158zZVeMyKPHSIEDJBPKIHzdTJeuBTlIOzJ%2FO2pFKxILqfL6xmZMuJ%2BvjNc9gojbIXxqvYsGl46gOrcjSDM%2BdQBnM9pHiGEDHIYiJBI8vzbOoaxrnKVh1M8jTcrujRWNiEApGmXgkdepJ3MhJqymybyTMEJTlJUUpBDqMxghCPInIccLtusBZ5LCtYhPkZ4WGBRRimKeSAVkdR%2FHiPTrH%2BjQMqo76MQ6zxRJGRSQfCUSqGsQQxNEBBzHsQQIOC2yNGe1R1LUjptkUhH0UcPE3qKgr4fEJp9JKZEyDJVYpA0wIQAKqSyli1i9I63pBAiso%2BGUexrgKEIjNMwIwsSFgfFicLNNcIXOvC5RFVClaOlE0XArcwTbBYUprn%2BuKzIQdIvCceE7l4dGplS8m6qSRzDFi8GqM8KJ0q8ZS%2Bv0a5lDMUa6slCalnkEDWV4Yztj4wSmV4DJtpEHo%2BiSFoWBUmSsnmIwnjyqypuUJRBtaDSKT6%2FKDDEokme6xx1INMgktGcyikGKq%2FOp7WTEtoZHBED2RKoAIINOB2WqsEAWPJVKOs8grPj4RV8uD6hhOhxKFGuuK%2FOC4JHjkNz2reXhFURVaWJkcLYRyhijl4aImgy0RHskuzDC0a5bIg8pJALSwNdkW0yDCdonOoSHkQcwSWYYp0yBYUQi6yTwCw82p5kCjMfJsECokevwqhAJLrDMcwaGxXh6X8IuXEUboeh44MnY8hx6TyhCbOSqhVGZVI00b8mZohqQ4yErIUfM6z8pEjz61koplKi2I8o6JS1Mm1Qqj0BCWes2rcJB1EB5EUR1PKhZeCWPgEB6%2FkhHawSDI85o%2BPKJmm3h9pjIcwKJBFUaa36EI3HU%2B0yDhspFeOWIQtYzx3GulQCvyYJQskMLuqPO8MvkTFYksGhM8CjoEEboxQgcDJtwZDXPKNETpsJYgeAkXuyciQfA%2BHiUWoVfj2mmDnGUMoxgIE1gQAElRZqZVdOpCU6RTb6idAiCwpdUxtmjP8CMYoCZMVHqoRSbUSj9xkE0RC%2FIcQtgdIcf8EZIK4JNuDfkHgTL1C5lw8E5I4ZBmckkMGSDLLRgnCtV0N5sHQJ9CaC2CAJ5HkuPkdk4N2wmnmMSAW1gCzqEtM%2BdeHp%2BQ8ggJKLkE8c5tl%2BOSSRAs4T3jFLAs2bUqGynkgTAoqJcQXluHaRC3pMJtjKKMKIpdOQixcqbG4J5e4%2FwvOOCOKIQrpGOIMP8z5XiEFsm8NcFsrg3BhOsaKrC9YyKnLUMYDUigbmMiWAYkoci1GCQ8JIRd5aMThMwjkRQ2oBjBEgkYfwyiWVLh6WYRstTVDbGkAou8I4mJFokyYaTDiNG2J3GQ2NNhM04c8UoCBFKj1%2BDMJ094sQlFZJNOkAIMroTjJMIiVIRZ1E1hFUk8x3RYnyLZU0dIglRkrFCRS4QWohTPKCckoQeTQQ5MPGRvd4S1DCFCEMRp2yiVIjqX4nIsTOXNo8%2BSoLZT4tXICm8fwCxIJvAKHsKSIxDxHprE8jpDgJB9IkJofRTZJ0kSLG4r1mFRlSEGCEOpsKj2GH6cka0HrJEMQcS5w9Uy1BWUGJYqoSTAKRo6DuJoHoHHmH8f2EMLae2xkgxAbZ1Q53JIhHswR5LF0JjvNlYtXkIhSODT2BQbjKmfKiJOmkXXoRNmMFUF4SSSJDDneCIq%2FRaW5mtbGwRGwC1ZDED48lMnRkjLvD6WojCa3HERfIsIBYqgRGiDCkwTa%2FFxLNI8kQvSEBCqMAMTp8gCztOoR56kyAAF8ADcZBV3YAQEQOQUBhAIBQJgEAAAvBA2gkAgDgDIcgEgpDrvkIoZQYA1BaB0BAPQGgAAUV6cDiAABYEEUAAKiQHQAAlGQFw7gkD4GwDAXAYAkAftfeoNA56AC0KQSBvpA0gEgJAkCNGA0gAAerofQ2AjAmFMAhl2SGz0yDQxhrDxG6CmFozYAjAAydifgPAADEeM2BXQu1dAB6YTSAAAq36QCYFPTJ7A37kA4HQHIFD%2BAIAwf3ZIJAdQYCQBEJIMg67N3bvXSgS9khpC3qUCoDQJ6X3Ub3Ye492A31oeAxhz9z7f0AaA3gUD4H3BQZg3BrwfGwthcEyJsTknpNIDgJIAA5DoMjABrZAKh0BICAegXTyWFNIDADAKAP6%2F0UCVuAZAABhAA8gAWQAAoAEkAAyABRTQ4nGu1fa5VgASpV2zABlcTvW30yAI1RjQjmj3oDqGNgjKGkDqAw%2BNojQRwvhdA2QBAhWiASYQDgVru2wOuHcJVvQAA1AgUAdQOCQDVhrLX2ude65oPrA2tDDdGwAIiEBAFLKH0BcFwHUKA6AADu33gOtGXau1dKgkBEAIOAN9%2FnTuiYk5luofA9pZcwJgDdxgACeSAcvYDkDAHQb6QBED244BMfRKuVdDAAQVA24Dg6ATMgBMEBpzJ6ad0%2Fu5d67OpItAA%3D%22%2C%22compiler%22%3A%22%2Fopt%2Fclang%2Bllvm-3.4.1-x86_64-unknown-ubuntu12.04%2Fbin%2Fclang%2B%2B%22%2C%22options%22%3A%22-std%3Dc%2B%2B11%20-O2%20-libstd%3Dlibc%2B%2B%22%7D%5D%7D

template<size_t idx>
constexpr uint32_t crc32(const char* str)
{
	return (crc32<idx - 1>(str) >> 8) ^ crc_table[(crc32<idx - 1>(str) ^ str[idx]) & 0x000000FF];
}

template<>
constexpr uint32_t crc32<size_t(-1)>(const char* str)
{
	return 0xFFFFFFFF;
}

#define char_array_crc32(x) (crc32<sizeof(x) - 2>(x) ^ 0xFFFFFFFF)
